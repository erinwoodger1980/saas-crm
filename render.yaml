services:
  - type: web
    name: api
    env: node
    rootDir: api
    buildCommand: corepack enable && pnpm i --frozen-lockfile && pnpm run build
    startCommand: pnpm run start
    preDeployCommand: npx prisma migrate deploy
    healthCheckPath: /health
    plan: starter
    envVars:
      - key: ML_URL
        sync: false  # Set this in Render dashboard to your ML service URL (e.g., https://ml-xyz.onrender.com)
  - type: web
    name: web
    env: node
    rootDir: web
    buildCommand: corepack enable && pnpm i --frozen-lockfile && pnpm run build
    startCommand: pnpm run start
    healthCheckPath: /health
    plan: starter
    envVars:
      - key: NODE_ENV
        value: production
      - key: API_ORIGIN
        value: https://joinery-ai.onrender.com
      - key: NEXT_PUBLIC_API_BASE
        sync: false  # Set this in Render dashboard to: https://joinery-ai.onrender.com
      - key: NEXT_PUBLIC_FOUNDERS_PROMO_CODE
        sync: false  # Set this in Render dashboard (optional)
      - key: NEXT_PUBLIC_DISCOUNT_DEADLINE
        sync: false  # Set this in Render dashboard (optional)
      - key: NEXT_PUBLIC_STRIPE_CHECKOUT_URL_MONTHLY
        sync: false  # Set this in Render dashboard (optional)
      - key: NEXT_PUBLIC_STRIPE_CHECKOUT_URL_ANNUAL
        sync: false  # Set this in Render dashboard (optional)
  - type: web
    name: ml
    env: docker
    rootDir: ml
    dockerfilePath: ./Dockerfile
    envVars:
      - key: DATABASE_URL
        sync: false  # Set this in Render dashboard to your PostgreSQL URL
      - key: API_SERVICE_URL
        value: https://joinery-ai.onrender.com
      - key: PORT
        value: 8000
